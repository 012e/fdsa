[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020
    Health_Check On
    Parsers_File /fluent-bit/etc/fluent-bit-parsers.conf

# Input from application log files
[INPUT]
    Name              tail
    Path              /var/log/app/*.log
    Parser            json
    Tag               spring.app
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    DB                /var/log/flb_app.db

# Input from forward protocol (for direct logging from Spring Boot)
[INPUT]
    Name   forward
    Listen 0.0.0.0
    Port   24224

# Add hostname and other metadata
[FILTER]
    Name    record_modifier
    Match   *
    Record  hostname ${HOSTNAME}
    Record  service fdsa-backend

# Parse and enrich logs
[FILTER]
    Name   modify
    Match  *
    Add    environment development
    Add    application fdsa

# Output to OpenSearch
[OUTPUT]
    Name            opensearch
    Match           *
    Host            opensearch
    Port            9200
    Index           spring-logs
    Suppress_Type_Name On
    Trace_Output    Off
    Trace_Error     On
    Replace_Dots    On
    Logstash_Format On
    Logstash_Prefix spring-logs
    Logstash_DateFormat %Y.%m.%d
    Time_Key        @timestamp
    Generate_ID     On
    Retry_Limit     5
    Buffer_Size     512KB

# Stdout for debugging (optional - can be removed in production)
[OUTPUT]
    Name   stdout
    Match  *
    Format json_lines
